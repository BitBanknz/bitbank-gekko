import { expect } from 'chai';
import 'mocha';
import * as path from 'path'

import { CsvReader } from './csv-reader'

describe('CsvReader', () => {

    it('should return the correct featureset by date', async () => {

        let filePath = __dirname.split(path.sep)
        filePath.pop()
        filePath.push('test-data')
        filePath.push('bitbank-btc_eth.csv')
        const csvPath = filePath.join(path.sep)
        const csvReader = new CsvReader(csvPath, 'BTC_ETH')
        // looking for this line
        //33773723,0.090003140161036249,-9.51111730276446e-07,0,-0.0028422879302437815,0.09027764701560842,-3.3616476668977347e-06,0,0.00020705031894757198,0.090224008520896723,2.6321820138065622e-07,0,-0.00038733015387123847,1.0002534141658408,1.0016869473463597,BTC_ETH,2018-01-17 21:06:24.543210 UTC,2018-01-17 21:06:22.335692 UTC,0.0909392787983617,0.0005887000733996676,0.09145772379016842,0.0005780468197147631,0.09240779845772945,0.0006942978623465904,0.09131364653009626,0.0013721704634932375,1,0.09027039,0.09024752,1.0034077977635716,1.0003670266400764,0.99832262271280836,0.996980561404705,0.088859102773491225,0.091951037877354688,1.0104588540272579,1.0140613424294389
        //date: 2018-01-17 21:06:22.335692 UTC
        const featureset1 = await csvReader.getNextFeaturesetAsync(new Date('2018-01-17 21:06:22.335692 UTC'))
        console.log(featureset1)
        expect(featureset1.id).to.equal(33773723)

        // looking for this line
        //33775445,0.091323558051032441,-9.67094657476391e-06,0,0.0025211791562454382,0.0911619149470035,3.1265384112419306e-06,0,0.0007525066475772504,0.090645201651318952,8.1529370845727518e-07,0,-0.0049435970191207121,1.0013361162222283,0.9975738628405546,BTC_ETH,2018-01-17 21:10:44.052772 UTC,2018-01-17 21:10:42.378834 UTC,0.09096448638664907,0.0005707385026922452,0.091534654819524,0.0005508249515260665,0.09257887717829193,0.0006637643523369243,0.09096449291782098,0.0013745147647592315,1,0.09115413,0.0910325,0.99990014405551442,0.99705356945014212,0.99627496969499418,0.99395021509361958,0.089414446581404544,0.092531195506924069,1.0104588547335283,1.0140613431208965
        //date: 2018-01-17 21:10:42.378834 UTC
        const featureset2 = await csvReader.getNextFeaturesetAsync(new Date('2018-01-17 21:10:42.378834 UTC'))
        console.log(featureset2)
        expect(featureset2.id).to.equal(33775445)

        csvReader.dispose()
    });

});